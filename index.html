<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Sites Management Tool</title>

    <style>
        /* ë°°ê²½ ì´ë¯¸ì§€ ë ˆì´ì–´ ì„¤ì • */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        /* ë°°ê²½ ë¶ˆíˆ¬ëª…ë„ 80% ì¡°ì ˆì„ ìœ„í•œ ì˜¤ë²„ë ˆì´ */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            /* 80% ë¶ˆíˆ¬ëª…ë„ (0.8) */
            z-index: -1;
        }

        /* ===== ë©”ë‰´ ===== */
        .menu-row {
            display: flex;
            gap: 16px;
            margin-bottom: 18px;
            position: relative;
        }

        .menu-box {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 14px;
            background: rgba(245, 247, 250, 0.9);
            /* ë©”ë‰´ ë°•ìŠ¤ë„ ì‚´ì§ íˆ¬ëª…í•˜ê²Œ */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            flex: 1;
        }

        .menu-box h3 {
            margin: 0 0 8px 0;
            font-size: 15px;
        }

        /* ===== ê³µí†µ ì…ë ¥ì°½ ë†’ì´ í†µì¼ ===== */
        input,
        select {
            height: 32px;
            padding: 4px 8px;
            box-sizing: border-box;
            font-size: 14px;
        }

        /* ===== ê²€ìƒ‰ ===== */
        .search-row {
            margin-top: 10px;
            display: flex;
            gap: 6px;
        }

        .search-row input {
            flex: 1;
        }

        /* ===== ì¦ê²¨ì°¾ê¸° ë°” ===== */
        .fav-bar {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 16px;
            background: rgba(255, 248, 230, 0.9);
        }

        .fav-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            margin: 4px;
            border-radius: 20px;
            background: #ffe9a8;
            border: 1px solid #e0c36a;
            cursor: grab;
            font-size: 14px;
        }

        .fav-item a {
            text-decoration: none;
            color: #333;
        }

        .fav-item a:hover {
            text-decoration: underline;
        }

        /* ===== ë©”ì¸ ===== */
        .main {
            display: flex;
            gap: 18px;
            position: relative;
        }

        .group-panel {
            width: 220px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            background: rgba(250, 250, 250, 0.9);
        }

        .group-item {
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 6px;
            border: 1px solid transparent;
        }

        .group-item:hover {
            background: #e9f1ff;
        }

        .group-item.active {
            background: #dbe8ff;
            border-color: #7aa2ff;
            font-weight: bold;
        }

        .site-panel {
            flex: 1;
        }

        .site {
            padding: 8px;
            border: 1px solid #aaa;
            margin: 6px 0;
            background: rgba(249, 249, 249, 0.9);
            border-radius: 6px;
            cursor: grab;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .site.drag-over {
            border: 2px dashed #000;
            background: #eef3ff;
        }

        .site a {
            text-decoration: none;
            color: #0366d6;
        }

        .site a:hover {
            text-decoration: underline;
        }

        .site-url {
            color: #666;
            font-size: 13px;
            max-width: 420px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .group-title-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        button {
            margin-left: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="menu-row">

        <div class="menu-box">
            <h3>ğŸ’¾ ì‚¬ì´íŠ¸ ë°±ì—… / ê²€ìƒ‰</h3>
            <button onclick="backupData()">ë°±ì—…</button>
            <button onclick="restoreClick()">ë³µì›</button>
            <button onclick="bgFile.click()">ë°°ê²½</button>
            <button onclick="resetBg()" style="color:red;">ë°°ê²½ì‚­ì œ</button>
            <input type="file" id="restoreFile" hidden accept=".json">
            <input type="file" id="bgFile" hidden accept="image/*">

            <div class="search-row">
                <input id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" onkeydown="if(event.key==='Enter') searchGoogle()">
                <button onclick="searchGoogle()">êµ¬ê¸€</button>
                <button onclick="searchNaver()">ë„¤ì´ë²„</button>
            </div>

        </div>

        <div class="menu-box">
            <h3>ğŸ“ ê·¸ë£¹ ìƒì„±</h3>
            <input id="newGroupInput">
            <button onclick="addGroup()">ìƒì„±</button>
        </div>

        <div class="menu-box">
            <h3>â• ì‚¬ì´íŠ¸ / í´ë” ì¶”ê°€</h3>
            <input id="nameInput" placeholder="ì´ë¦„"><br>
            <input id="urlInput" placeholder="URL ë˜ëŠ” í´ë”"><br>
            <select id="groupSelect"></select>
            <button onclick="addSite()">ì¶”ê°€</button>
        </div>

    </div>

    <div class="fav-bar">
        <b>â­ ì¦ê²¨ì°¾ê¸°</b>
        <div id="favBar"></div>
    </div>

    <div class="main">

        <div class="group-panel" id="groupPanel"></div>

        <div class="site-panel">
            <div class="group-title-bar">
                <h3 id="currentGroupTitle"></h3>
                <button onclick="renameGroup()">ì´ë¦„ìˆ˜ì •</button>
                <button onclick="deleteGroup()">ì‚­ì œ</button>
            </div>
            <div id="siteList"></div>
        </div>

    </div>

    <script>

        let groups = [];
        let sites = [];
        let favorites = [];
        let bgImg = ""; // ë°°ê²½ ì´ë¯¸ì§€ ë°ì´í„°

        let selectedGroup = null;
        let editIndex = null;

        let dragSiteIndex = null;
        let dragGroupIndex = null;
        let dragFavIndex = null;

        /* ===== ê²€ìƒ‰ ===== */
        function getSearchText() {
            return encodeURIComponent(searchInput.value.trim());
        }
        function searchGoogle() {
            const q = getSearchText();
            if (!q) return;
            window.open("https://www.google.com/search?q=" + q, "_blank");
        }
        function searchNaver() {
            const q = getSearchText();
            if (!q) return;
            window.open("https://search.naver.com/search.naver?query=" + q, "_blank");
        }

        /* ===== ë°°ê²½ ì´ë¯¸ì§€ ì²˜ë¦¬ ===== */
        bgFile.addEventListener("change", e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                bgImg = ev.target.result;
                applyBg(bgImg);
                saveData();
            };
            reader.readAsDataURL(file);
        });

        function applyBg(url) {
            if (url) {
                document.body.style.backgroundImage = `url('${url}')`;
            } else {
                document.body.style.backgroundImage = "none";
            }
        }

        function resetBg() {
            if (confirm("ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
                bgImg = "";
                applyBg("");
                saveData();
            }
        }

        /* ===== URL ===== */
        function normalizeUrl(input) {
            if (!input) return "";
            input = input.trim();
            if (/^(https?:\/\/|file:\/\/)/i.test(input)) return input;
            if (/^[a-zA-Z]:[\\/]/.test(input))
                return "file:///" + input.replace(/\\/g, "/");
            if (/^\\\\/.test(input))
                return "file:" + input.replace(/\\/g, "/");
            if (input.includes(".")) return "https://" + input;
            return input;
        }
        function getIcon(url) {
            return url.startsWith("file://") ? "ğŸ“" : "ğŸŒ";
        }

        /* ===== ì €ì¥ ===== */
        function saveData() {
            localStorage.setItem("siteData",
                JSON.stringify({ groups, sites, favorites, bgImg }));
        }
        function loadData() {
            const d = JSON.parse(localStorage.getItem("siteData"));
            if (d) {
                groups = d.groups || [];
                sites = d.sites || [];
                favorites = d.favorites || [];
                bgImg = d.bgImg || "";
                applyBg(bgImg);
            }
        }

        /* ===== ë°±ì—…/ë³µì› ===== */
        function backupData() {
            const blob = new Blob(
                [JSON.stringify({ groups, sites, favorites, bgImg }, null, 2)],
                { type: "application/json" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "sites_backup.json";
            a.click();
        }
        function restoreClick() { restoreFile.click(); }

        restoreFile.addEventListener("change", e => {
            const f = e.target.files[0];
            if (!f) return;
            const r = new FileReader();
            r.onload = ev => {
                const d = JSON.parse(ev.target.result);
                groups = d.groups || [];
                sites = d.sites || [];
                favorites = d.favorites || [];
                bgImg = d.bgImg || "";
                applyBg(bgImg);
                saveData();
                renderAll();
            };
            r.readAsText(f);
        });

        /* ===== ê·¸ë£¹ ===== */
        function addGroup() {
            const n = newGroupInput.value.trim();
            if (!n || groups.includes(n)) return;
            groups.push(n);
            newGroupInput.value = "";
            saveData(); renderAll();
        }

        function renameGroup() {
            if (!selectedGroup) return;
            const n = prompt("ìƒˆ ì´ë¦„", selectedGroup);
            if (!n || groups.includes(n)) return;
            groups = groups.map(g => g === selectedGroup ? n : g);
            sites.forEach(s => { if (s.group === selectedGroup) s.group = n; });
            selectedGroup = n;
            saveData(); renderAll();
        }

        function deleteGroup() {
            if (!selectedGroup) return;
            if (!confirm("ê·¸ë£¹ ì‚­ì œ?")) return;
            groups = groups.filter(g => g !== selectedGroup);
            sites.filter(s => s.group === selectedGroup).forEach(s => {
                const idx = sites.indexOf(s);
                favorites = favorites.filter(f => f !== idx);
            });
            sites = sites.filter(s => s.group !== selectedGroup);
            selectedGroup = groups[0] || null;
            saveData(); renderAll();
        }

        /* ===== ì‚¬ì´íŠ¸ ===== */
        function addSite() {
            const name = nameInput.value.trim();
            let url = urlInput.value.trim();
            const group = groupSelect.value;
            if (!name || !url) return;
            url = normalizeUrl(url);

            if (editIndex !== null) {
                sites[editIndex] = { name, url, group };
                editIndex = null;
            } else {
                sites.push({ name, url, group });
            }

            nameInput.value = "";
            urlInput.value = "";
            saveData(); renderSites(); renderFavorites();
        }

        function editSite(i) {
            nameInput.value = sites[i].name;
            urlInput.value = sites[i].url;
            groupSelect.value = sites[i].group;
            editIndex = i;
        }

        function deleteSite(i) {
            if (!confirm("ì‚­ì œ?")) return;
            sites.splice(i, 1);
            favorites = favorites.filter(x => x !== i).map(x => x > i ? x - 1 : x);
            saveData(); renderAll();
        }

        /* ===== ì¦ê²¨ì°¾ê¸° ===== */
        function toggleFavorite(i) {
            if (favorites.includes(i))
                favorites = favorites.filter(x => x !== i);
            else
                favorites.push(i);
            saveData(); renderFavorites(); renderSites();
        }

        function renderFavorites() {
            favBar.innerHTML = "";
            favorites.forEach((idx, pos) => {
                const s = sites[idx];
                if (!s) return;

                const d = document.createElement("div");
                d.className = "fav-item";
                d.draggable = true;

                d.ondragstart = () => dragFavIndex = pos;
                d.ondragover = e => e.preventDefault();
                d.ondrop = e => {
                    if (dragFavIndex === null) return;
                    const mv = favorites.splice(dragFavIndex, 1)[0];
                    favorites.splice(pos, 0, mv);
                    dragFavIndex = null;
                    saveData(); renderFavorites();
                };

                d.innerHTML = `
   ${getIcon(s.url)}
   <a href="${s.url}" target="_blank">${s.name}</a>
   <button onclick="toggleFavorite(${idx})">âŒ</button>
  `;
                favBar.appendChild(d);
            });
        }

        /* ===== ê·¸ë£¹ íŒ¨ë„ ===== */
        function renderGroupPanel() {
            groupPanel.innerHTML = "";
            groups.forEach((g, idx) => {
                const div = document.createElement("div");
                div.className = "group-item" + (g === selectedGroup ? " active" : "");
                div.textContent = g;
                div.draggable = true;

                div.onclick = () => { selectedGroup = g; renderAll(); };

                div.ondragover = e => e.preventDefault();
                div.ondrop = e => {
                    if (dragSiteIndex !== null) {
                        sites[dragSiteIndex].group = g;
                        dragSiteIndex = null;
                        saveData(); renderAll();
                    }
                    if (dragGroupIndex !== null) {
                        const d = groups.splice(dragGroupIndex, 1)[0];
                        groups.splice(idx, 0, d);
                        dragGroupIndex = null;
                        saveData(); renderAll();
                    }
                };
                div.ondragstart = () => dragGroupIndex = idx;

                groupPanel.appendChild(div);
            });
        }

        /* ===== ì‚¬ì´íŠ¸ ëª©ë¡ ===== */
        function renderSites() {
            currentGroupTitle.textContent = "ğŸ“ " + (selectedGroup || "");
            siteList.innerHTML = "";

            sites.forEach((s, i) => {
                if (s.group !== selectedGroup) return;

                const div = document.createElement("div");
                div.className = "site";
                div.draggable = true;

                div.ondragstart = () => dragSiteIndex = i;

                div.ondragover = e => {
                    e.preventDefault();
                    div.classList.add("drag-over");
                };
                div.ondragleave = () => div.classList.remove("drag-over");

                div.ondrop = e => {
                    e.stopPropagation();
                    div.classList.remove("drag-over");
                    if (dragSiteIndex === null || dragSiteIndex === i) return;

                    const moved = sites.splice(dragSiteIndex, 1)[0];
                    sites.splice(i, 0, moved);

                    favorites = favorites.map(idx => {
                        if (idx === dragSiteIndex) return i;
                        if (dragSiteIndex < i && idx > dragSiteIndex && idx <= i) return idx - 1;
                        if (dragSiteIndex > i && idx < i && idx >= i) return idx + 1;
                        return idx;
                    });

                    dragSiteIndex = null;
                    saveData();
                    renderSites();
                    renderFavorites();
                };

                const favMark = favorites.includes(i) ? "â­" : "â˜†";

                div.innerHTML = `
   ${getIcon(s.url)}
   <a href="${s.url}" target="_blank">${s.name}</a>
   <a class="site-url" href="${s.url}" target="_blank">${s.url}</a>
   <button onclick="toggleFavorite(${i})">${favMark}</button>
   <button onclick="editSite(${i})">ìˆ˜ì •</button>
   <button onclick="deleteSite(${i})">ì‚­ì œ</button>
  `;

                siteList.appendChild(div);
            });
        }

        /* ===== ì˜µì…˜ ===== */
        function renderGroupOptions() {
            groupSelect.innerHTML = "";
            groups.forEach(g => {
                const o = document.createElement("option");
                o.value = g; o.textContent = g;
                groupSelect.appendChild(o);
            });
        }

        /* ===== ì „ì²´ ===== */
        function renderAll() {
            if (!selectedGroup) selectedGroup = groups[0];
            renderGroupOptions();
            renderGroupPanel();
            renderSites();
            renderFavorites();
        }

        /* ===== ì´ˆê¸°í™” ===== */
        loadData();
        if (groups.length === 0) groups.push("ê¸°ë³¸");
        renderAll();

    </script>

    <script>
        // 1. ìš°í´ë¦­ ë©”ë‰´ ì°¨ë‹¨ (ì•ŒëŒ ì—†ì´)
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        }, false);

        // 2. ë“œë˜ê·¸ ë° í…ìŠ¤íŠ¸ ì„ íƒ ì°¨ë‹¨ (ì†ŒìŠ¤ ë³µì‚¬ ë°©ì§€)
        document.addEventListener('selectstart', function (e) {
            e.preventDefault();
        }, false);

        // 3. ì£¼ìš” ë³´ì•ˆ ë‹¨ì¶•í‚¤ ì°¨ë‹¨
        document.onkeydown = function (e) {
            // F12 (ê°œë°œì ë„êµ¬) ì°¨ë‹¨
            if (e.keyCode == 123) return false;

            // Ctrl+U (ì†ŒìŠ¤ ë³´ê¸°), Ctrl+S (ì €ì¥), Ctrl+Shift+I (ê²€ì‚¬) ì°¨ë‹¨
            if (e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0) || (e.shiftKey && e.keyCode == 'I'.charCodeAt(0)))) {
                return false;
            }
        };
    </script>

</body>

</html>